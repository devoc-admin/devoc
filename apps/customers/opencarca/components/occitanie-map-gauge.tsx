import { motion } from "motion/react";
import { useId } from "react";

const hotspots = [
  { label: "Toulouse", x: 150, y: 155 },
  { label: "Montpellier", x: 315, y: 150 },
];

export function OccitanieMapGauge({
  percent = 75,
  className,
}: {
  percent?: number;
  className?: string;
}) {
  const titleId = useId();
  const clamped = Math.min(100, Math.max(0, percent));
  const radius = 160;
  const circ = 2 * Math.PI * radius;
  const dash = (clamped / 100) * circ;
  return (
    <div className={["relative w-full", className].filter(Boolean).join(" ")}>
      <motion.svg
        animate={{ opacity: 1, scale: 1 }}
        aria-labelledby={titleId}
        initial={{ opacity: 0, scale: 0.95 }}
        role="img"
        transition={{ duration: 0.6 }}
        viewBox="0 0 520 520"
      >
        <title
          id={titleId}
        >{`Carte Occitanie — production numérique ${clamped}%`}</title>
        <circle
          className="opacity-40"
          cx={260}
          cy={260}
          fill="none"
          r={radius}
          stroke="var(--border)"
          strokeWidth={12}
        />
        <motion.circle
          animate={{ strokeDasharray: `${dash} ${circ - dash}` }}
          className="neon-glow"
          cx={260}
          cy={260}
          fill="none"
          initial={{ strokeDasharray: `0 ${circ}` }}
          r={radius}
          stroke="var(--primary)"
          strokeDasharray={`${dash} ${circ - dash}`}
          strokeLinecap="round"
          strokeWidth={12}
          transform="rotate(-90 260 260)"
          transition={{ duration: 1, ease: "easeInOut" }}
        />
        <g transform="translate(90 160) scale(1.1)">
          <path
            d="M135.333 16.9333C135.867 22.9333 135.6 24.2667 133.333 25.6C131.867 26.5333 130.667 28 130.667 28.8C126.41 33.879 119.531 47.803 113.05 49.3333C99.8947 59.1677 105.24 56.2883 105.333 66.8C105.333 68.9333 106 70.6667 106.667 70.6667C109.641 73.495 106.958 77.2086 104.4 77.6C99.33 71.1377 89.946 81.2896 97.2 85.3333C99.4667 86.5333 99.6 87.2 98.4 90.6667C94.8105 99.099 91.8771 98.4244 87.2 103.6C79.3334 112.533 79.8667 112.4 76.2667 109.067C74 106.933 72.8 106.533 72.4 107.6C65.9679 113.782 31.8466 113.158 33.8667 122.133C35.6058 126.81 30.0933 125.217 30 122.4C28.0931 112.827 24.3822 121.267 19.8667 121.333C17.6 121.333 14.9334 122.133 13.8667 123.2C9.99605 128.585 14.0869 126.96 14.1334 131.333C13.8158 134.69 11.9459 135.885 12.5334 138.8C13.0667 141.333 12.5334 143.867 11.2 146C6.83668 152.376 8.39792 157.583 15.6 159.067C18 159.467 21.0667 161.067 22.4 162.4C24.693 164.693 26.3601 168.774 25.8635 170.177C25.7537 170.487 25.5381 170.667 25.2 170.667C22.5356 173.175 24.9485 179.669 27.6 175.6C28.2667 174.533 28.9334 175.6 29.3334 178.667C29.8667 182 29.3334 184 27.7334 185.6C24.5627 188.958 26.7358 199.346 21.8667 200C18.8997 201.402 18.8652 205.196 16.1334 206.667C14.0175 208.854 14.2331 212.889 12.1334 214.133C10.2667 212.933 6.40004 219.733 7.33337 222.667C7.65214 225.815 5.36718 227.864 5.33337 230.8C5.33337 234 6.40004 235.467 11.2 238.4C25.764 246.804 20.6765 254.456 36.6667 249.467C44.5334 246.8 47.8667 247.067 49.7334 250.267C55.0178 254.919 54.6237 248.806 57.6 249.067C58.5334 250 63.6 250.667 70.4 250.667C84.6688 251.039 79.3885 246.437 79.8667 237.467C81.6051 232.052 89.4783 236.063 94 238.4C96.1334 239.6 100.133 240.667 102.667 240.933C115.443 241.236 112.339 248.881 122.267 248.267C129.867 247.733 131.6 248.667 134.8 255.2C136.8 259.467 140 261.333 140 258.267C143.904 252.563 148.542 256.994 153.2 258C165.141 262.285 159.288 261.548 158.4 267.333C157.867 270.133 158.267 270.8 161.2 271.467C168.267 273.067 174.133 276.667 176 280.667C178.533 285.733 182.533 286.4 186.933 282.267C195.185 269.027 217.848 290.647 220.667 286.533C221.2 285.867 223.6 285.6 226.267 286.133C230.267 286.933 230.8 286.667 230.533 284.533C230.004 279.363 244.767 274.728 249.467 274C255.2 273.2 256.533 273.467 258 275.6C262.392 279.586 269.879 277.95 266 272.533C263.223 264.914 259.118 266.641 258.133 259.067C257.2 251.867 258 224.133 259.333 218C260.667 212 269.2 200 276 194.933C286.412 187.502 290.323 194.239 297.733 185.867C300.533 182.667 303.467 180 304 180C305.333 180 314.933 173.733 316 172.133C316.4 171.6 319.333 169.2 322.533 166.933C326.667 163.867 329.867 162.667 333.467 162.667C342.092 162.777 335.39 168.888 341.867 171.2C347.183 173.168 351.747 166.061 356.267 163.067C364.533 157.6 365.333 156.667 363.467 155.2C361.333 153.733 361.467 153.333 364.667 150.133C375.23 142.795 375.85 151.006 377.867 136.533C379.215 124.756 377.981 132.488 387.2 122.667C393.2 116.4 393.333 116 391.333 112.933C390.267 111.2 387.867 108.533 386 106.933C383.333 104.667 382.667 102.933 382.933 98.5333C383.302 89.915 375.016 85.4454 369.467 81.7333C359.501 77.1426 363.911 85.3585 360.86 85.3333C358.219 84.9258 360.651 80.7789 358.667 79.3333C356.933 78.2667 349.333 82.8 349.333 84.9333C349.333 85.8667 349.067 86.6667 348.667 86.6667C347.467 86.6667 340.8 82.2667 339.867 80.8C339.333 80.1333 337.6 80 336 80.4C333.2 81.0667 333.067 80.8 333.733 76.5333C334.4 72.9333 333.867 71.2 331.333 68.6667C329.733 66.8 327.867 63.2 327.467 60.6667C326.933 58.1333 325.733 55.6 324.8 55.0667C322.4 53.7333 320.267 45.7333 320.667 40.1333C320.977 34.8219 317.003 36.1884 313.867 32.5333C311.733 30.1333 309.067 28 308 28C306.933 28 305.2 26.8 304.267 25.3333C303.333 23.8666 301.733 22.6667 300.533 22.6667C299.333 22.6667 298.133 23.8666 297.733 25.3333C297.333 26.8 295.867 28.1333 294.533 28.1333C289.447 29.3261 288.229 25.9932 287.2 22.1333C283.758 3.61551 275.172 23.8033 267.931 22.1251C263.674 20.0757 261.333 22 261.333 25.4666C261.333 26.9333 260.738 27.7186 260.133 28C258.803 28.6192 257.6 32.2666 256 37.4667C253.2 46.2666 252.667 46.8 251.067 44.5333C249.867 42.9333 249.467 40.2666 249.867 37.7333C250.4 34.2666 249.867 33.0667 247.867 32C246.533 31.2 244.933 29.0667 244.533 27.3333C244 24.9333 242.8 24 240.533 24C238.4 24 237.333 23.2 237.333 21.6C237.333 20.2667 236.667 18.5333 235.867 17.7333C228.499 16.9459 224.73 31.8768 222.125 34.2403C221.059 35.1736 220 35.7333 220 36.8C220 37.7333 218.667 40.5333 217.067 43.0667C214.533 46.8 213.2 47.6 209.733 47.6C205.005 46.8004 198.139 43.6909 194.4 48.2666C192.375 49.2626 193.504 44.7955 191.867 43.0667C190.667 41.8667 190.667 40.4 191.867 37.2C193.2 33.3333 192.933 32.2666 190 28C189.307 26.2358 185.356 15.9151 185.333 14.6667C182.337 10.4492 173.719 11.9464 168.533 15.3333C164.133 18.1333 163.333 18 157.733 12C146.175 3.15475 134.13 4.29422 135.333 16.9333Z"
            fill="#5c5248ff"
            stroke="#f179175b"
            strokeWidth={2}
          />
          {hotspots.map((h, i) => (
            <g key={h.label} transform={`translate(${h.x} ${h.y})`}>
              <circle
                className="marker-pulse"
                fill="var(--primary)"
                r={10}
                style={{ animationDelay: `${i * 0.2}s` }}
              />
              <text
                fill="var(--foreground)"
                fontSize={14}
                fontWeight={700}
                textAnchor="middle"
                y={22}
              >
                {h.label}
              </text>
            </g>
          ))}
        </g>
        <motion.text
          animate={{ opacity: 1 }}
          dominantBaseline="middle"
          fill="var(--foreground)"
          fontSize={60}
          fontWeight={800}
          initial={{ opacity: 0 }}
          textAnchor="middle"
          transition={{ delay: 0.3 }}
          x={260}
          y={260}
        >
          {clamped}%
        </motion.text>
      </motion.svg>
    </div>
  );
}
